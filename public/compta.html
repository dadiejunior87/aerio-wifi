<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AERIO | Tr√©sorerie Alpha</title>
    <link href="https://fonts.googleapis.com" rel="stylesheet">
    <style>
        :root { --primary: #00C2FF; --accent: #00F5A0; --bg: #020617; --glass: rgba(15, 23, 42, 0.7); --danger: #FF4B4B; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: var(--bg); color: white; padding: 40px; min-height: 100vh; background-image: radial-gradient(circle at top right, rgba(0, 194, 255, 0.05), transparent); }

        .header-compta { margin-bottom: 40px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 20px; display: flex; justify-content: space-between; align-items: center; }
        
        .balance-card {
            background: linear-gradient(135deg, rgba(0, 194, 255, 0.1), rgba(112, 0, 255, 0.1));
            padding: 40px; border-radius: 35px; border: 1px solid var(--primary);
            text-align: center; margin-bottom: 40px; backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5); position: relative; overflow: hidden;
        }
        .balance-card h2 { font-size: 11px; text-transform: uppercase; letter-spacing: 3px; color: var(--primary); margin-bottom: 10px; font-weight: 800; }
        .balance-card .amount { font-size: 56px; font-weight: 900; text-shadow: 0 0 30px var(--primary); letter-spacing: -2px; }

        .main-grid { display: grid; grid-template-columns: 1.2fr 1fr; gap: 30px; max-width: 1200px; margin: 0 auto; }

        .payout-form, .history-panel {
            background: var(--glass); padding: 40px; border-radius: 30px;
            border: 1px solid rgba(255,255,255,0.05); backdrop-filter: blur(20px);
        }
        
        h3 { font-size: 16px; margin-bottom: 25px; font-weight: 800; color: var(--primary); text-transform: uppercase; letter-spacing: 1px; }

        .input-group { margin-bottom: 20px; }
        label { display: block; font-size: 10px; font-weight: 800; color: #475569; text-transform: uppercase; margin-bottom: 8px; margin-left: 5px; }
        
        input, select {
            width: 100%; padding: 15px 20px; background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 15px;
            color: white; outline: none; transition: 0.3s; font-weight: 600;
        }
        input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 194, 255, 0.1); }

        .btn-withdraw {
            width: 100%; padding: 20px; border: none; border-radius: 18px;
            background: var(--accent); color: #020617; font-weight: 900;
            cursor: pointer; text-transform: uppercase; letter-spacing: 1px;
            transition: 0.4s; box-shadow: 0 10px 30px rgba(0, 245, 160, 0.2);
        }
        .btn-withdraw:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(0, 245, 160, 0.4); }

        /* TABLEAU MINI */
        table { width: 100%; border-collapse: collapse; font-size: 12px; }
        th { text-align: left; color: #475569; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        td { padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.02); }

        .back-link { display: block; text-align: center; margin-top: 40px; color: #475569; text-decoration: none; font-size: 11px; font-weight: 800; text-transform: uppercase; }
    </style>
</head>
<body>

    <div class="header-compta">
        <div>
            <h1 style="font-size: 28px; font-weight: 900; letter-spacing: -1.5px;">Tr√©sorerie <span style="color:var(--primary)">Alpha</span></h1>
            <p style="color: #475569; font-size: 13px;">Extraction des actifs vers Mobile Money.</p>
        </div>
        <div style="background: rgba(0,245,160,0.1); padding: 8px 15px; border-radius: 50px; color: var(--accent); font-size: 10px; font-weight: 900; border: 1px solid var(--accent);">STABILIT√â FLUX : 100%</div>
    </div>

    <div class="balance-card">
        <h2>SOLDE DISPONIBLE (NET 85%)</h2>
        <div class="amount" id="current-balance">0 F</div>
        <div style="margin-top: 15px; height: 4px; background: rgba(255,255,255,0.05); border-radius: 10px; width: 200px; margin: 20px auto;">
            <div style="width: 100%; height: 100%; background: var(--primary); box-shadow: 0 0 15px var(--primary); border-radius: 10px;"></div>
        </div>
    </div>

    <div class="main-grid">
        <!-- FORMULAIRE -->
        <div class="payout-form">
            <h3>Configuration du Retrait</h3>
            <form id="payoutForm">
                <div class="input-group">
                    <label>Montant (F CFA)</label>
                    <input type="number" id="amount" placeholder="Min: 500 F" required>
                </div>
                <div class="input-group">
                    <label>Num√©ro de R√©ception</label>
                    <input type="text" id="phone" placeholder="Ex: 691285152" required>
                </div>
                <div class="input-group">
                    <label>R√©seau Mobile</label>
                    <select id="network" required>
                        <option value="orange_cm">üá®üá≤ Orange Money Cameroun</option>
                        <option value="mtn_cm">üá®üá≤ Mobile Money Cameroun</option>
                        <option value="airtel_td">üáπüá© Airtel Money Tchad</option>
                        <option value="moov_td">üáπüá© Moov Money Tchad</option>
                    </select>
                </div>
                <button type="submit" class="btn-withdraw">Initialiser l'Injection</button>
            </form>
        </div>

        <!-- HISTORIQUE RAPIDE -->
        <div class="history-panel">
            <h3>Recettes R√©centes</h3>
            <table>
                <thead><tr><th>DATE</th><th>BRUT</th><th>GAIN NET</th></tr></thead>
                <tbody id="quick-history">
                    <!-- Chargement JS -->
                </tbody>
            </table>
        </div>
    </div>

    <a href="/dashboard" class="back-link">‚Üê Retour au QG Alpha</a>

    <script>
        async function loadData() {
            try {
                const res = await fetch('/api/my-stats');
                const tickets = await res.json();
                
                // Calcul Solde
                const balance = tickets.reduce((sum, t) => sum + (t.amount * 0.85), 0);
                document.getElementById('current-balance').innerText = balance.toLocaleString() + " F";

                // Historique
                const historyEl = document.getElementById('quick-history');
                historyEl.innerHTML = tickets.reverse().slice(0, 5).map(t => `
                    <tr>
                        <td>${new Date(t.date).toLocaleDateString()}</td>
                        <td style="opacity:0.6">${t.amount} F</td>
                        <td style="color:var(--accent); font-weight:800">+${(t.amount * 0.85).toFixed(0)} F</td>
                    </tr>
                `).join('') || "<tr><td colspan='3'>Aucun flux d√©tect√©.</td></tr>";

            } catch(e) { console.error("Erreur Synchro."); }
        }

        document.getElementById('payoutForm').onsubmit = async (e) => {
            e.preventDefault();
            const btn = document.querySelector('.btn-withdraw');
            const montant = document.getElementById('amount').value;
            
            btn.innerText = "CONNEXION S√âCURIS√âE...";
            btn.disabled = true;

            setTimeout(() => {
                alert(`[PROTOCOLE ALPHA] Retrait de ${montant} F initialis√© vers le r√©seau. Versement sur votre compte Mobile Money sous 1h √† 2h.`);
                location.reload();
            }, 1500);
        };

        window.onload = loadData;
    </script>
</body>
</html>
